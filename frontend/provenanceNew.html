<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diamond Provenance | Diamond Auth Block</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="entityInterfaceNew.html">Register Entity</a></li>
          <li><a href="provenanceNew.html" class="active">Diamond Provenance</a></li>
          <li><a href="marketplaceInterface.html">Diamond Marketplace</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Logo -->
    <div class="logo-floating">
      <img src="assets/dab-logo-new.png" alt="Logo" />
    </div>

    <!-- Main Content -->
    <main class="main-container">
      <section class="form-section" id="walletStatus">
        <h2>Wallet Status</h2>
        <button id="connectWalletBtn" class="cta-button">Connect Wallet</button>
        <div class="wallet-info">
          <p><strong>Connected Account:</strong> <span id="accountAddress">Not Connected</span></p>
          <p><strong>Network:</strong> <span id="networkName">Not Connected</span></p>
          <p><strong>Role:</strong> <span id="accountRole">Unknown</span></p>
        </div>
      </section>

     <!-- Miner Section -->
<section class="form-section hidden-by-role" id="minerActions">
  <h2>Register Raw Diamond (Miners)</h2>
  <form id="registerRawDiamondForm">
    <div class="form-row">
      <label for="rawOrigin">Origin</label>
      <input type="text" id="rawOrigin" required />
    </div>
    <div class="form-row">
      <label for="rawExtractionDate">Extraction Date (Unix Timestamp)</label>
      <input type="number" id="rawExtractionDate" required />
    </div>
    <div class="form-row">
      <label for="rawWeight">Weight (carats)</label>
      <input type="number" id="rawWeight" step="0.01" required />
    </div>
    <div class="form-row">
      <label for="rawCharacteristics">Characteristics</label>
      <input type="text" id="rawCharacteristics" required />
    </div>
    <button type="submit" class="cta-button" id="registerRawDiamondBtn">Register Diamond</button>
  </form>
</section>

<!-- Manufacturer Section -->
<section class="form-section hidden-by-role" id="manufacturerActions">
  <h2>Process Diamond (Manufacturers)</h2>
  <form id="processDiamondForm">
    <div class="form-row">
      <label for="processRawDiamondId">Raw Diamond ID</label>
      <input type="number" id="processRawDiamondId" required />
    </div>
    <div class="form-row">
      <label for="processedWeight">New Weight (carats)</label>
      <input type="number" id="processedWeight" step="0.01" required />
    </div>
    <div class="form-row">
      <label for="processedCharacteristics">New Characteristics</label>
      <input type="text" id="processedCharacteristics" required />
    </div>
    <button type="submit" class="cta-button" id="processDiamondBtn">Process Diamond</button>
  </form>
</section>

<!-- Certifier Section -->
<section class="form-section hidden-by-role" id="certifierActions">
  <h2>Certify Diamond (Certifiers)</h2>
  <form id="certifyDiamondForm">
    <div class="form-row">
      <label for="certifyDiamondId">Diamond ID</label>
      <input type="number" id="certifyDiamondId" required />
    </div>
    <div class="form-row">
      <label for="certificationId">Certification ID</label>
      <input type="text" id="certificationId" required />
    </div>
    <button type="submit" class="cta-button" id="certifyDiamondBtn">Certify</button>
  </form>
</section>

<!-- Transfer Diamond Section -->
<section class="form-section">
  <h2>Transfer Diamond</h2>
  <form id="transferDiamondForm">
    <div class="form-row">
      <label for="transferDiamondId">Diamond ID</label>
      <input type="number" id="transferDiamondId" required />
    </div>
    <div class="form-row">
      <label for="transferToAddress">Recipient Address</label>
      <input type="text" id="transferToAddress" placeholder="0x..." required />
    </div>
    <button type="submit" class="cta-button" id="transferDiamondBtn">Transfer</button>
  </form>
</section>

<!-- View Info Section -->
<section class="form-section">
  <h2>View Diamond History</h2>
  <form id="getDiamondInfoForm">
    <div class="form-row">
      <label for="infoDiamondId">Diamond ID</label>
      <input type="number" id="infoDiamondId" required />
    </div>
    <button type="submit" class="cta-button" id="getDiamondInfoBtn">Get Diamond Info</button>
  </form>
  <div id="diamondInfoDisplay" class="info-display hidden"></div>
  <div id="diamondHistoryDisplay" class="info-display hidden">
    <h3 class="text-xl font-semibold mb-2">Diamond History</h3>
    <div id="historyList"></div>
  </div>
</section>


      <!-- Status Output -->
      <div id="statusMessage" class="status-message hidden"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"
      type="application/javascript"
    ></script>
    <script type="module">
      // Import contract configuration from centralized file
      import { getContractConfig } from './contracts.js';
      
      window.onload = function () {
        console.log(
          "LOG: window.onload event triggered for ProvenanceContract frontend."
        );
        if (typeof ethers === "undefined") {
          console.error(
            "FATAL ERROR: Ethers.js library (ethers object) is not defined. Ensure 'ethers-5.7.umd.min.js' is in the same directory as this HTML file."
          );
          const body = document.querySelector("body");
          const errorDiv = document.createElement("div");
          errorDiv.innerHTML =
            '<h1 style="color:red; text-align:center; padding:20px;">Critical Error: Ethers.js library failed to load. DApp cannot function. Check browser console (F12) for details. Ensure ethers-5.7.umd.min.js is downloaded and in the same folder.</h1>';
          body.prepend(errorDiv);
          return;
        }
        console.log("LOG: Ethers.js library appears to be loaded.", ethers);

        // Get the Provenance contract configuration from the centralized file
        const provenanceConfig = getContractConfig('PROVENANCE_CONTRACT');
        if (!provenanceConfig) {
          console.error("Failed to load Provenance contract configuration");
          return;
        }
        
        // Use the contract address and ABI from the configuration
        const provenanceContractAddress = provenanceConfig.address;
        const provenanceContractABI = provenanceConfig.abi;

        // Continue with the rest of your code...
        // ... existing code ...
      }
    </script>
  </body>
</html>